#!/bin/bash

# INTEL CONFIDENTIAL
#
# Copyright 2020-2020 Intel Corporation.
#
# This software and the related documents are Intel copyrighted materials, and your use of
# them is governed by the express license under which they were provided to you ("License").
# Unless the License provides otherwise, you may not use, modify, copy, publish, distribute,
# disclose or transmit this software or the related documents without Intel's prior written permission.
#
# This software and the related documents are provided as is, with no express or implied warranties,
# other than those that are expressly stated in the License.

# Get FEC VFs pci addresses from ENV variable
IFS=',' read -r -a fec_vfs <<< ${{ fec_env_variable }}

# Set PCI addresses for DPDK binding
sed -i "s/ethDevice0=.*/ethDevice0={{ gnodeb_fronthaul_vf1 }}/" {{ l1_dpdk_script }}
sed -i "s/ethDevice1=.*/ethDevice1={{ gnodeb_fronthaul_vf2 }}/" {{ l1_dpdk_script }}
sed -i "s/ethDevice2=.*/ethDevice2=${QAT0}/" {{ l1_dpdk_script }}
sed -i "s/ethDevice3=.*/ethDevice3=${QAT1}/" {{ l1_dpdk_script }}
sed -i "s/fecDevice0=.*/fecDevice0=${fec_vfs[0]}/" {{ l1_dpdk_script }}

# Unset unused variables
for i in {4..11}
do
   sed -i "s/ethDevice$i=.*/ethDevice$i=/" {{ l1_dpdk_script }}
done
sed -i "s/fecDevice1=.*/fecDevice1=/" {{ l1_dpdk_script }}
