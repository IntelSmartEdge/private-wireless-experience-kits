#!/bin/sh

# INTEL CONFIDENTIAL
#
# Copyright 2020-2020 Intel Corporation.
#
# This software and the related documents are Intel copyrighted materials, and your use of
# them is governed by the express license under which they were provided to you ("License").
# Unless the License provides otherwise, you may not use, modify, copy, publish, distribute,
# disclose or transmit this software or the related documents without Intel's prior written permission.
#
# This software and the related documents are provided as is, with no express or implied warranties,
# other than those that are expressly stated in the License.

for i in {0..{{ ansible_processor_vcpus -1}}}
do
  #Set core 0-39 to 2.5GHz (0x1900). Please change according to your CPU model
  wrmsr -p ${i} 0x199 {{ turbo_set }}
done

#Set Uncore to Max
wrmsr -p 0 0x620 0x1e1e
wrmsr -p {{ ansible_processor_vcpus -1}} 0x620 0x1e1e
