# INTEL CONFIDENTIAL
#
# Copyright 2020-2020 Intel Corporation.
#
# This software and the related documents are Intel copyrighted materials, and your use of
# them is governed by the express license under which they were provided to you ("License").
# Unless the License provides otherwise, you may not use, modify, copy, publish, distribute,
# disclose or transmit this software or the related documents without Intel's prior written permission.
#
# This software and the related documents are provided as is, with no express or implied warranties,
# other than those that are expressly stated in the License.

---

- name: Copy remote-dn chart to host
  copy:
    src: "remote-dn-chart"
    dest: "{{ cera_charts_path }}"
    mode: a=rx,u+w

- name: Copy remote-dn image to host
  copy:
    src: "remote-dn-image"
    dest: "{{ cera_images_path }}"
    mode: a=rx,u+w

- name: Build remote-dn image
  command: >
    docker build
    --build-arg http_proxy=$http_proxy
    --build-arg https_proxy=$https_proxy
    --build-arg no_proxy=$no_proxy
    -t remote-dn:1.0 .
  args:
    chdir: "{{ cera_images_path }}/remote-dn-image"
  changed_when: false

- name: Deploy remote-dn pod
  command: helm install -n {{ cera_namespace_name }} remote-dn ./remote-dn-chart/ --set image.repository=remote-dn --set nodeName={{ node_name }}
  args:
    chdir: "{{ cera_charts_path }}"
  changed_when: false
